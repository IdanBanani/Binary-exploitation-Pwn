CHALLENGE=ch44

CC=gcc
CFLAGS=-g -Wall -fstack-protector-all -Wstack-protector -Wl,-z,relro 

SRC=$(CHALLENGE).c
OBJ=$(SRC:.c=.o)
BIN=$(CHALLENGE)

.DEFAULT_GOAL := challenge
.PHONY : clean all

pre-build:
	@echo "Removing immutable flags..."

post-build:
	@echo "Adding immutable flags..."

all: pre-build
	@echo "Compiling..."
	$(MAKE) $(BIN)

$(BIN): $(OBJ)
	#$(CC) -o $@ $(SRC) $(CFLAGS)

challenge: all
	@echo "Applying permissions..."
	rm -f $(OBJ)
	chmod 777 $(BIN)
	$(MAKE) post-build

clean: pre-build
	rm -f $(BIN) $(OBJ)
	$(MAKE) post-build

