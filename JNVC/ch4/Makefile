CHALLENGE=q4

CC=gcc
CFLAGS=-g -Wall -Wextra -m32 -fstack-protector-all -D_FORTIFY_SOURCE=2 -Wl,-z,now -Wl,-z,relro,-z,noexecstack

SRC=$(CHALLENGE).c
OBJ=$(SRC:.c=.o)
BIN=$(CHALLENGE)

.DEFAULT_GOAL := challenge
.PHONY : clean all

all: 
	@echo "Compiling..."
	$(MAKE) $(BIN)

$(BIN): $(OBJ)
	$(CC) -o $@ $(SRC) $(LDFLAGS) $(CFLAGS)

challenge: all
	@echo "Applying permissions..."
	rm -f $(OBJ)
	chmod 400 .passwd
	chmod 777 $(BIN)
	

clean: 
	rm -f $(BIN) $(OBJ)
	

